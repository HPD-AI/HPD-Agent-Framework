# As a Toolkit Capability

Expose a multi-agent workflow as a tool inside a parent agent using the `[MultiAgent]` attribute. The parent agent can invoke the whole workflow like any other tool call.

## Basic Usage

```csharp
public class ResearchToolkit
{
    [MultiAgent("Run a full research and writing pipeline")]
    public async Task<AgentWorkflowInstance> ResearchPipeline()
    {
        return await AgentWorkflow.Create()
            .AddAgent("researcher", new AgentConfig
            {
                SystemInstructions = "Research the topic thoroughly."
            })
            .AddAgent("writer", new AgentConfig
            {
                SystemInstructions = "Write a clear answer based on the research."
            })
            .From("researcher").To("writer")
            .BuildAsync();
    }
}

var agent = await new AgentBuilder()
    .WithToolkit<ResearchToolkit>()
    .BuildAsync();
```

The parent agent sees `ResearchPipeline` as a callable tool. When it invokes it, the full workflow runs and events bubble up to the parent's event stream.

---

## Provider Inheritance

Agents inside the workflow that don't have their own `Provider` configured automatically inherit the parent agent's chat client at execution time — no extra configuration needed.

```csharp
// These agents will use whatever model the parent agent uses
.AddAgent("researcher", new AgentConfig
{
    SystemInstructions = "..."
    // No Provider set — inherits from parent
})
```

---

## [MultiAgent] Attribute

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `Description` | `string?` | Method name | Description shown to the LLM. |
| `Name` | `string?` | Method name | Custom tool name. |
| `StreamEvents` | `bool` | `true` | Stream inner workflow events to the parent's event stream. |
| `TimeoutSeconds` | `int` | `300` | Workflow execution timeout in seconds. |

```csharp
[MultiAgent(
    "Analyze documents and produce a structured report",
    Name = "DocumentAnalysis",
    TimeoutSeconds = 600
)]
public async Task<AgentWorkflowInstance> AnalysisPipeline() { ... }
```

### Typed metadata variant

For compile-time validation with conditional registration:

```csharp
public class WorkflowMetadata : IToolMetadata
{
    public bool HasResearchCapability { get; set; }
}

public class PipelineToolkit
{
    [MultiAgent<WorkflowMetadata>("Full research pipeline")]
    [ConditionalFunction("HasResearchCapability")]
    public async Task<AgentWorkflowInstance> ResearchPipeline() { ... }
}

var agent = await new AgentBuilder()
    .WithToolkit<PipelineToolkit>(new WorkflowMetadata { HasResearchCapability = true })
    .BuildAsync();
```

→ See [02.1.4 Tool Dynamic Metadata.md](../Tools/02.1.4%20Tool%20Dynamic%20Metadata.md) for conditional registration details.
